# Pipeline to build a nucleotide library

Builds libraries of dinucleotide and trinucleotide RNA fragments, at 0.5A and 1.0A precision.

Input: nonredundant nucleotide fragments (nucleotide-fragments submodule), generated by the nucleotide fragment pipeline

## Library building instructions

Sublibraries are built at the dinucleotide and trinucleotide level, for each sequence motif and for each precision level.
Sequence motifs contain every combination of A and C (4 resp. 8 motifs for dinucleotide and trinucleotide). To extend to A/C/G/U, lib-mutate.py must be run after the steps have completed.

### Step 1. Download nucleotide fragments and fragment PDB templates

These are defined as Git submodules. Run the following command to download them:
`git submodule update --init --recursive --progress`

### Step 2. Run the clustering

Clustering is performed using a pairwise RMSD (after Kabsch superposition) cutoff that corresponds to the desired precision (0.5A, 1.0A and 2.0A).

For each sublibrary, clustering is performed by a removing iteratively the largest cluster from the fragment pool.The 50 largest clusters are determined probabilistically; for the remaining fragment pool, the full pairwise RMSD matrix is computed.

After the clustering is done, the origin (PDB code provenance) of each cluster is analyzed.

Scripts:

- clust.sh  (or equivalent script with parallel cluster jobs)
- clust-origin.sh

### Step 2. Build the library

Script:

- build-library.sh  (or equivalent script with parallel cluster jobs)

## Closest fit analysis

This repo contains an algorithm that calculates the closest fit (nearest-neighbour)
of each fragment, excluding fragments from the same PDB.

Scripts to run:

- closest-fit.sh  (or equivalent script with parallel cluster jobs)
- The closest-fit-analysis notebook to verify the calculation against brute force

## Completeness analysis

...

- The notebook in the verification/ subfolder, to compare the calculation

## Context-specific analysis

...
(notebook)

For closest-fit.py, there is another version in context-specific/, allowing a specific Pfam or Rfam.
    - TODO: Needs some file location adaptation
    - Note: needs to run convert-original.py
